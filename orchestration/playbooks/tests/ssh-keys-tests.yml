---
- name: "TEST: SSH keys needs to be correctly installed"
  stat:
    path: "{{ item }}"
  with_items:
    - "{{ home }}/.ssh/id_rsa"
    - "{{ home }}/.ssh/id_rsa.pub"
  register: ssh_keys
  failed_when: ssh_keys.stat.exists == false

- name: "TEST: Public SSH key needs to have 4096 bits"
  shell: ssh-keygen -l -f {{ home }}/.ssh/id_rsa.pub | awk '{print $1}'
  register: ssh_bits
  changed_when: ssh_bits.stdout != "4096"
  failed_when: ssh_bits.stdout != "4096"
